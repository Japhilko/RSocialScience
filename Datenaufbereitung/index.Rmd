---
title: "Datenaufbereitung"
author: "Jan-Philipp Kolb"
date: "21 Juni 2017"
output: md_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



## data.frames

Beispieldaten generieren:

```{r}
AGE <- c(20,35,48,12)
SEX <- c("m","w","w","m")
```

Diese beiden Vektoren zu einem data.frame verbinden:

```{r}
Daten <- data.frame(Alter=AGE,Geschlecht=SEX)
```

Anzahl der Zeilen/Spalten herausfinden

```{r}
nrow(Daten) # Zeilen
ncol(Daten) # Spalten
```

## Indizieren

Indizieren eines dataframe:

```{r}
AA <- 4:1
A2 <- cbind(A1,AA)
A2[1,1]
A2[2,]
A2[,1]
A2[,1:2]
```

## Matrizen und Arrays

-  In Matrizen und Arrays stehen meist nur numerische Werte.
-  Dadurch wird beispielsweise Matrix Multiplikation möglich.
-  Anders als beim data.frame sind mehr als zwei Dimensionen möglich.

```{r}
A <- matrix(seq(1,100), nrow = 4)
dim(A)
```


## Listen

-  Eine Liste in R entspricht einem geschachtelten Array in anderen Programmiersprachen
-  Listen können alles enthalten
-  Listen können geschachtelt sein
-  Listen sollte man sehr bedacht verwenden
			
## Indizieren einer Liste

```{r}
A4 <- list(A1,1)
A4
A4[[2]]
```


## Logische Operatoren

```{r}
# Ist 1 größer als 2?
1>2
1<2

1==2
```



## Operatoren um Subset für Datensatz zu bekommen

Diese Operatoren eignen sich gut um Datensätze einzuschränken

```{r}
Daten
Daten[AGE>20,]
```

## Datensätze einschränken

```{r}
Daten[SEX=="w",]
# gleiches Ergebnis:
Daten[SEX!="m",]
```


## Weitere wichtige Optionen

```{r}
# Ergebnis in ein Objekt speichern
subDat <- Daten[AGE>20,]
```

```{r}
# mehrere Bedingeungen können mit
# & verknüpft werden:
Daten[AGE>18 & SEX=="w",]
```

## Die Nutzung einer Sequenz


```{r}
Daten[1:3,]
```



## [Variablen Labels](https://stackoverflow.com/questions/2151147/using-stata-variable-labels-in-r)

```{r}
library(foreign)
dat <- read.dta("https://github.com/Japhilko/RSocialScience/blob/master/data/GPanel.dta?raw=true")
```

```{r}
var.labels <- attr(dat,"var.labels")
```

## Ein Überblick

```{r}
nrow(dat)
ncol(dat)
```

```{r}
head(dat)
```


## Indizieren

- Das Dollarzeichen kann man nutzen um einzelne Spalten anzusprechen

```{r}
head(dat$a11c019a)

dat$a11c019a[1:10]
```

- Man kann auch Zahlen nutzen um auf die Spalten zuzugreifen

```{r}
head(dat[,1])
```

## Datentypen

```{r}
# as.numeric()
```


## [Rekodieren](https://www.r-bloggers.com/recoding-variables-in-r-pedagogic-considerations/)

```{r}
library(car)
?recode
```


## [Exkurs - Labels wie verwenden]()

```{r}
library("forcats")
browseVignettes()
```


```{r}
library(tibble)

gpanel1 <- as_tibble(gpanel)

head(gpanel1)
```

## Schleifen

```{r}
erg <- vector()

for (i in 1:ncol(dat)){
  erg[i] <- length(table(dat[,i]))  
}
```



## Fehlende Werte

```{r}
dat$bazq020a[dat$bazq020a==-99] <- NA
```




- [Quick-R zu fehlenden Werten](http://www.statmethods.net/input/missingdata.html)

- [Fehlende Werte rekodieren](http://uc-r.github.io/na_recode)
